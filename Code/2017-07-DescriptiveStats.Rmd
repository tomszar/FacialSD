---
output:
  html_document: default
  html_notebook: default
---
# Preliminaries

We will load the necessary libraries

```{r libraries, warning=FALSE}
library(ggplot2)
library(dplyr)
library(GGally)
library(plotly)
library(gridExtra)
library(psych)
library(Hotelling)
library(ggjoy)
library(tidyr)
```

Setting wd and loading databases

```{r databases}
setwd('..')
path <- getwd()
setwd(paste(path, "/Results/PCA", sep = ""))
getwd()
#Read data
coeffs   <- read.csv("coeffs.csv")
eigenvec <- read.csv("eigenvectors.csv", header=F)
eigenval <- read.csv("eigenvalues.csv", header=F)
means    <- read.csv("means.csv", header=F)
facets   <- read.csv("facets.csv", header=F)
```

## Data cleaning

For data cleaning, we will remove every individual that is neither Male or Female, and individuals with NAs in any variable (Height, Weight, and Age)

```{r data cleaning}
#Remove no sex participants
coeffs = filter(coeffs, Sex == 'Female' | Sex == 'Male')
coeffs = droplevels(coeffs)
#Removed NAs from database
coeffs = na.omit(coeffs)
dim(coeffs)
```

After cleaning, we end up with `r nrow(coeffs)` individuals

# Descriptive stats

We can look at summary statistics

```{r summary}
summary(coeffs[,2:5])
```

As well as summary statistics grouped by sex

```{r summary by sex}
describeBy(coeffs[,3:5], coeffs$Sex)
```

we can also explore some correlograms

```{r correlogram, warning=FALSE}
ggpairs(coeffs, columns = 2:7, ggplot2::aes(colour=Sex, alpha = 0.2), 
       lower = list(continuous = "smooth"))
```

# Facial sexual dimorphism analysis

Comparing sex differences in each PC using joy plots

```{r joyplots, fig.height = 15, fig.width = 10, fig.align = "center"}
source("PlotPCs.R")
p1 = PlotPCs(coeffs[, c(2,6:ncol(coeffs)) ], "PC1", "PC9")
p2 = PlotPCs(coeffs[, c(2,6:ncol(coeffs)) ], "PC10", "PC19")
p3 = PlotPCs(coeffs[, c(2,6:ncol(coeffs)) ], "PC20", "PC29")
p4 = PlotPCs(coeffs[, c(2,6:ncol(coeffs)) ], "PC30", "PC39")
grid.arrange(p1, p2, p3, p4)

p1 = PlotPCs(coeffs[, c(2,6:ncol(coeffs)) ], "PC40", "PC49")
p2 = PlotPCs(coeffs[, c(2,6:ncol(coeffs)) ], "PC50", "PC59")
p3 = PlotPCs(coeffs[, c(2,6:ncol(coeffs)) ], "PC60", "PC69")
p4 = PlotPCs(coeffs[, c(2,6:ncol(coeffs)) ], "PC70", "PC79")
grid.arrange(p1, p2, p3, p4)
```

